name: code-metrics
on:
  push:
    branches: 
      - master
      - develop
    paths-ignore:
      - '**.md'
jobs:
  code-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Generate code metrics
        uses: dotnet/samples/github-actions/DotNet.GitHubAction@main
        with:
          owner: ${{ github.repository_owner }}
          name: ${{ github.repository }}
          branch: ${{ github.ref }}
          dir: ${{ './github-actions/DotNet.GitHubAction' }}
      - name: Create pull request
        uses: peter-evans/create-pull-request@v3.4.1
        if: ${{ steps.dotnet-code-metrics.outputs.updated-metrics }} == 'true'
        with:
            title: '${{ steps.dotnet-code-metrics.outputs.summary-title }}'
            body: '${{ steps.dotnet-code-metrics.outputs.summary-details }}'
            commit-message: 'Code metrics, automated pull request.'